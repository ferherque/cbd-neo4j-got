<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
    <link rel="stylesheet"
        href="https://neo4j-documentation.github.io/developer-resources/language-guides/assets/css/main.css">
    <title>Proyecto CBD - Neo4J</title>
</head>

<body>
    <div id="headerbar"></div>
    <div class="row">
        <div class="col-md-5">
            <div class="panel panel-default">
                <div class="panel-heading" id="top10">Number of seats in a region</div>
                <form role="query1" class="navbar-form" data-toggle="collapse" id="query1">
                    <div class="form-group">
                        <label style="margin-top: 2rem;">Region: </label><br>
                        <select id="region-select" class="form-control" name="region">
                        </select>
                        <button class="btn btn-default" type="submit">Search</button>
                    </div>
                </form>
                <div id="result-query-1">

                </div>
            </div>
        </div>
        <div class="col-md-5">
            <div class="panel panel-default">
                <div class="panel-heading" id="houseSeason">Most important houses by season</div>
                <form role="query2" class="navbar-form" data-toggle="collapse" id="query2">
                    <div class="form-group">
                        <label style="margin-top: 2rem;">Season: </label><br>
                        <select id="season-select" class="form-control" name="season">
                        </select>
                        <button class="btn btn-default" type="submit">Search</button>
                    </div>
                </form>
                <form role="clearQuery2" class="navbar-form" data-toggle="collapse" id="clearQuery2">
                    <div class="form-group">
                        <button class="btn btn-default" type="submit">Clear</button>
                    </div>
                </form>
                <table id="results" class="table table-striped table-hover">
                    <thead>
                    </thead>
                    <tbody>
                    </tbody>
                </table>

                </div>
            </div>
        </div>
        <div class="col-md-5">
            <div class="panel panel-default">
                <div class="panel-heading" id="houseSeason">10 House with more allieds</div>
                <table id="allieds" class="table table-striped table-hover">
                    <thead>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <div id="loading">
                    <p style="text-align: center; margin-top: 1rem; margin-bottom: 1rem;">Loading data...</p>
                </div>
                </div>
            </div>
        </div>
        <div class="col-md-5">
            <div class="panel panel-default">
                <div class="panel-heading" id="houseSeason">Gender ratio</div>

                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        $("#headerbar").load("/static/headerbar.html");

        function getRegions() {
            $.get("/regions",
                    function (data) {
                        const select = $("#region-select")
                        data.forEach(function (region, index) {
                        $("<option value=" + region[1] + ">" + region[0].name + "</option>").appendTo(select)
                    });
                })
            return false;
        }
        function getSeasons() {
            const select = $("#season-select")
            $("<option value=Season_1>Season 1</option>").appendTo(select)
            $("<option value=Season_2>Season 2</option>").appendTo(select)
            $("<option value=Season_3>Season 3</option>").appendTo(select)
            $("<option value=Season_4>Season 4</option>").appendTo(select)
            $("<option value=Season_5>Season 5</option>").appendTo(select)
            $("<option value=Season_6>Season 6</option>").appendTo(select)

            return false;
        }
        function search() {
            const query=$("#query1").find("select[name=region]").val();
            const name=$("#query1").find("select[name=region] option:selected").text();
            $.get("/searchRegion?q=" + encodeURIComponent(query),
                    function (data) {
                        $("#result-query-1").empty().append("<p style='text-align: center; margin-top: 1rem; margin-bottom: 1rem;'><b>" + name + " has " + data + " seats</b></p>");
                    });
            return false;
        }
        function searchHouseSeason() {
            const query=$("#query2").find("select[name=season]").val();
            const name=$("#query2").find("select[name=season] option:selected").text();
            $.get("/searchHouseSeason?q=" + encodeURIComponent(query),
                function (data) {
                    $("table#results thead").empty().append($("<tr><th>House</th><th>Number XX</th></tr>"))
                    const t = $("table#results tbody").empty();
                    data.forEach(function (house, index) {
                        $("<tr><td class='house'>" + house[0]+"</td>"
                            + "<td>" + house[1]+"</td>"
                            + "</tr>").appendTo(t)
                    });
                }, "json");
            return false;
        }
        function houseMostAllied() {
            $.get("/houseMostAllied",
                function (data) {
                    $("table#allieds thead").append($("<tr><th>House</th><th>Allieds</th><th>Swear loyalty</th><th>Number of person</th></tr>"))
                    const t = $("table#allieds tbody").empty();
                    $("#loading").empty();
                    data.forEach(function (house, index) {
                        $("<tr><td class='house'>" + house[0]+"</td>"
                            + "<td>" + house[1]+"</td>"
                            + "<td>" + house[2]+"</td>"
                            + "<td>" + house[3]+"</td>"
                            + "</tr>").appendTo(t)
                    });
                }, "json");
            return false;
        }
        function genderRatio() {
            $.get("/genderRatio",
                function (data) {
                    console.log(data)
                }, "json");
            return false;
        }
        function clearQuery2() {
            $("table#results thead").empty();
            $("table#results tbody").empty();
            return false;
        }
        houseMostAllied();
        getSeasons()
        getRegions();
        genderRatio();
        $("#query1").submit(search);
        $("#query2").submit(searchHouseSeason);
        $("#clearQuery2").submit(clearQuery2);
    </script>
</body>

</html>